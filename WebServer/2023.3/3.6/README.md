# 进程间通信（重要）

* 进程是一个独立的资源分配单元，不同进程（用户进程）之间的资源是独立的，没有关联，不能再一个进程中直接访问另一个进程的资源
* 但是，进程不是孤立的，不同的进程需要进行信息的交互和状态的传递等，因此需要进程间通信（IPC：Inter Processes Communication）
* 进程间通信的目的：
    * 数据传输：一个进程需要将他的数据发送给另一个进程
    * 通知事件：一个进程需要向另一个进程或者一组进程发送消息，通知它（它们）发生了某种事件（如进程终止时要通知父进程）
    * 资源共享：多个进程之间共享同样的资源，做到这一点，需要内核提供互斥和同步机制
    * 进程控制：有些进程希望完全控制另一个进程的执行（如Debug进程），此时控制进程希望能够拦截另一个进程的所有陷入和异常，并能够及时知道它的状态改变

## 进程间通信的方式以及基本原理

同一主机进程间通信：
  * Unix进程间通信方式：
    * 匿名管道
    * 有名管道
    * 信号
  * System V、POSIX进程间通信方式：
    * 消息队列
    * 共享内存
    * 信号量
不同主机（网络）进程间通信：
    Socket

### 匿名管道

* 管道也叫无名（匿名）管道，是UNIX系统IPC（进程间通信）的最古老形式，所有的UNIX系统都支持这种通信机制
* 例如：统计一个目录文件中的数目命令：ls | wc -l,为了执行该命令，shell创建了两个进程分别执行`ls`和`wc`
* 上述命令中的`|`代表管道符，通过`ls`命令查看当前目录下的所有文件名后将其写入管道的写入端，然后`wc`进程从管道的读取端读取文件名然后统计个数并输出到屏幕上

* 管道其实是一个在内核内存中维护的缓冲器，这个缓冲器的存储能力是有限的，不同的操作系统大小不一定相同
* 管道拥有文件的特质：读操作，写操作，匿名管道没有文件实体，有名管道有文件实体但不存储数据，可以按照操作文件的方式对管道进行操作
* 一个管道是一个字节流，使用管道时不存在消息或者消息边界的概念，从管道读取数据的进程可以读取任意大小的数据块，而不管写入进程写入管道的数据块的大小是多少
* 通过管道传递的数据是顺序的，从管道中读取出来的字节的顺序和他们被写入管道的顺序是完全一样的。
* 管道实现的底层数据结构是环形队列
* 管道中数据传递的方向是单向的，一端用于写入，一端用于读取，管道是半双工的。
* 从管道中读取数据是一次性操作，数据一旦被读走，他就从管道中被抛弃，释放空间以便写入更多的数据，在管道中无法使用`lseek()`来随机访问数据
* 匿名管道只能在拥有公共祖先的进程（父进程和子进程，或者两个兄弟进程，具有亲缘关系）之间使用。
  
* 创建匿名管道
    #include<unistd.h>
    int pipe(int pipefd[2]);

* 查看管道缓冲大小命令：
    ulimit -a

* 查看管道缓冲大小函数:
    #include<unistd.h>
    long fpathconf(int fd, int name);


