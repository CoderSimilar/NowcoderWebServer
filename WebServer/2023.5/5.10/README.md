# TCP四次挥手

```
四次挥手

当我们调用了close()函数的时候，就会执行断开连接的操作，使用TCP协议进行四次挥手。

断开连接为了释放资源。

不同于建立连接的三次握手，必须要客户端先向服务器发起连接请求，四次挥手断开连接的过程中，客户端和服务器端都可以主动发起断开连接。谁先调用close()谁就先发起。

因为在TCP连接的时候，采用三次握手建立的连接是双向的，在断开连接的时候也需要双向断开。


# mss: Maximum Segment Size(一条数据最大的数据量)
# win: 滑动窗口

1，客户端向服务器发起连接，客户端的滑动窗口是4096，一次发送的最大数据量是1460
2，服务器接受连接情况，告诉客户端服务器的窗口大小是6144，一次发送的最大数据量是1024
3，第三次握手
4，4 ~ 9客户端连续给服务器发送了6k的数据，每次发送1k
5，第10次，服务器告诉客户端，发送的6k数据已经接收到，存储在缓冲区中。缓冲区已经处理了2k，窗口大小是2k。
6，第11次，服务器告诉客户端，发送的6k数据已经接收到，存储在缓冲区中。缓冲区已经处理了4k，窗口大小是4k。
7，第12次，客户端给服务器发送了1k的数据
8，第13次，客户端主动和服务器断开连接，并且给服务器发送了1k的数据。（主动发起断开连接的一方只能接收数据，不能在向对方发送数据）
9，第14次，服务器回复ACK 8194，a：同意断开连接的请求；b：告诉客户端已经接收到对方发来的2k的数据
10：第15，16次：通知客户端滑动窗口的大小
11：第17次：第三次挥手，服务器端给客户端发送FIN。请求断开连接。
12：第18次：第四次挥手，客户端同意了服务器端的断开连接请求。
```

# TCP通信并发

> 要实现TCP通信服务器处理并发的任务，使用多线程或者多进程来解决
>
> 思路：
> 1，一个父进程，多个子进程
> 2，父进程负责等待并接受客户端的连接
> 3，子进程：完成通信，接收一个客户端连接，就创建一个子进程用于通信。
>
> 
