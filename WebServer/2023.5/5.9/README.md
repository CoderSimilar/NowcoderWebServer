# TCP三次握手
TCP 是一种面向连接的单播协议，在发送数据前，通信双方必须在彼此间建立一条连接。所谓的“连接”，其实是客户端和服务器的内存里保存的一份关于对方的信息，如 IP 地址、端口号等。

TCP 可以看成是一种字节流，它会处理 IP 层或以下的层的丢包、重复以及错误问题。在连接的建立过程中，双方需要交换一些连接的参数。这些参数可以放在 TCP 头部。

TCP 提供了一种可靠、面向连接、字节流、传输层的服务，采用三次握手建立一个连接。采用四次挥手来关闭一个连接。

三次握手和四次挥手是协议的行为，不是程序员要写的代码。

三次握手的目的是保证双方互相之间建立了连接。

三次握手发生在客户端连接的时候，当调用connect()函数的时候，底层会通过TCP协议进行三次握手。

> 第一次握手：
> 
> 1，客户端将SYN标志位置为1
> 
> 2，生成一个随机的32位序号seq = J，这个序号后边是可以携带数据（数据的大小）
> 
> 第二次握手：
> 
> 1，服务器端接收客户端的连接，ACK = 1
>
> 2，服务器会回发一个确认序号：ack = 客户端序号 + 数据长度 + SYN/FIN（按一个字节算）
>
> 3，服务器端会向客户端发起连接请求：SYN = 1
>
> 4，服务器会生成一个随机序号：seq = K
>
> 第三次握手：
>
> 1，客户端应答服务器的连接请求：ACK = 1；
>
> 2，客户端回复收到了服务器端的数据，ack = 服务器端的序号 + 数据长度 + SYN/FIN（按一个字节算）

# 滑动窗口

> 滑动窗口(SllIng window) 是一种流量控制技术，早期的网络通信中，通信双方不会考虑网络的拥挤情况直接发送数据。由于大家不知道网络拥塞状况，同时发送数据，导致中间节点阻塞掉包，谁也发不了数据，所以就有了滑动窗口机制来解决此问题。滑动窗口协议是用来改善吞吐量的一种技术，即容许发送方在接收任何应答之前传送附加的包。接收方告诉发送方在某一时刻能送多少包(称窗口尺寸)。

> TCP 中采用滑动窗口来进行传输控制，滑动窗口的大小意味着接收方还有多大的缓冲区可以用于接收数据。发送方可以通过滑动窗口的大小来确定应该发送多少字节的数据。当滑动窗口为 0 时，发送方一般不能再发送数据报。

> 滑动窗口是 TCP 中实现诸如 ACK 确认、流量控制、拥塞控制的承载结构。

窗口理解为缓冲区的大小。

滑动窗口的大小会随着发送数据和接收数据而变化。

通信的双方都有发送缓冲区和接收数据的缓冲区。

服务器：
    
    发送缓冲区（发送缓冲区的窗口）
    接收缓冲区（接收缓冲区的窗口）

客户端：

    发送缓冲区（发送缓冲区的窗口）
    接收缓冲区（接收缓冲区的窗口）

```
# mss: Maximum Segment Size(一条数据最大的数据量)
# win: 滑动窗口

1，客户端向服务器发起连接，客户端的滑动窗口是4096，一次发送的最大数据量是1460
2，服务器接受连接情况，告诉客户端服务器的窗口大小是6144，一次发送的最大数据量是1024
3，第三次握手
4，4 ~ 9客户端连续给服务器发送了6k的数据，每次发送1k
5，第10次，服务器告诉客户端，发送的6k数据已经接收到，存储在缓冲区中。缓冲区已经处理了2k，窗口大小是2k。
6，第11次，服务器告诉客户端，发送的6k数据已经接收到，存储在缓冲区中。缓冲区已经处理了4k，窗口大小是4k。
7，第12次，客户端给服务器发送了1k的数据
```




