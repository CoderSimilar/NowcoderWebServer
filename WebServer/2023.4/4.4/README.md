# 线程

* 与进程（process）类似，线程（thread）是允许应用程序**并发**执行多个任务的一种机制。一个进程可以包含多个线程。**同一个程序中的所有线程均会独立执行相同程序，且共享同一份全局内存区域，其中包括初始化数据段、未初始化数据段、以及堆内存段**。（传统意义上的UNIX进程只是多线程程序的一个特例，该进程只包含一个线程）（在linux底层，其实将线程当作进程去看）
* 并发：CPU在同一时刻只能处理一个任务，有多个任务处理的话，CPU会在各个任务之间快速切换，宏观上来看程序是同时执行。
* 并行：多个任务在微观上也在同时运行。
* 进程是CPU分配资源的最小单位，线程是操作系统调度执行的最小单位。
* 线程是轻量级的进程（LWP：Light Weight Process），在Linux环境下线程的本质仍是进程。
* 查看指定进程的`LWP`号：`ps -Lf pid`，即可列出进程号pid的线程。
  
# 进程和线程的区别

* 进程间的信息难以共享。由于出去只读代码段外，父子进程并未共享内存，因此必须采用一些进程间通信方式，在进程间进行信息交换。
* 调用`fork()`来创建进程的代价相对较高，即使利用写时复制的技术，仍然要复制诸如内存页表和文件描述符表之类的多种进程属性，意味着`fork()`调用在时间上的开销依然不菲。
* 线程之间能够方便、快速地共享信息。只需将数据复制到共享（全局或者堆）变量中即可。
* 创建线程比创建进程通常要快10倍甚至更多。线程间是共享虚拟地址空间的，无需采用写时复制来复制内存，也无需复制页表。

# 线程之间共享和非共享地资源

## 共享资源
* 进程ID和父进程ID
* 进程组ID和会话ID
* 用户ID和用户组ID
* 文件描述符表
* 信号处置
* 文件系统的相关信息：文件权限掩码（umask）、当前工作目录
* 虚拟地址空间（除栈，代码段）

## 非共享资源
* 线程ID
* 信号掩码
* 线程特有数据
* error变量
* 实时调度策略和优先级
* 栈、本地变量和函数的调用链接信息